<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Roblox Evolution Maze</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #0b1220;
      color: #eaf2ff;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    header {
      padding: 12px;
      background: #111a33;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    header h1 { margin: 0; font-size: 20px; }
    #stage {
      flex: 1;
      display: grid;
      place-items: center;
      position: relative;
    }
    canvas {
      border-radius: 12px;
      image-rendering: pixelated;
    }
    #banner {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(18,26,42,0.85);
      border: 1px solid rgba(255,255,255,0.18);
      padding: 8px 14px;
      border-radius: 10px;
      font-size: 14px;
      opacity: 0;
      transition: opacity 1s ease;
      max-width: 80%;
      text-align: center;
    }
    #banner.show { opacity: 1; }
    .overlay {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(0,0,0,0.5);
    }
    .card {
      background: #1a243f;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      color: #fff;
    }
    button {
      background: #ff3355;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      margin: 5px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>
    <h1>Roblox Evolution Maze</h1>
  </header>
  <div id="stage">
    <canvas id="game" width="960" height="560"></canvas>
    <div id="banner"></div>
    <div id="overlay" class="overlay">
      <div class="card">
        <h2>Press Play to Begin</h2>
        <p>Use W A S D or Arrow Keys to move.<br>Collect keys if required to unlock exits.<br>Press G to regenerate maze.</p>
        <button id="playBtn">Play</button>
        <button id="resetBtn">Reset</button>
        <button id="pauseBtn">Pause</button>
      </div>
    </div>
  </div>
  <script>
    const TILE = 40;
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const bannerEl = document.getElementById("banner");
    const overlay = document.getElementById("overlay");
    const playBtn = document.getElementById("playBtn");
    const resetBtn = document.getElementById("resetBtn");
    const pauseBtn = document.getElementById("pauseBtn");

    // Era themes
    const THEMES = {
      "2006": { wall:"#1b2a41", floor:"#0a1324", avatar:"#a2ff00" },
      "2012": { wall:"#3a1b41", floor:"#1a0a24", avatar:"#00ffff" },
      "2015": { wall:"#224466", floor:"#112233", avatar:"#ff8800" },
      "2016": { wall:"#263b66", floor:"#101b33", avatar:"#ffcc00" },
      "2018": { wall:"#4a2e88", floor:"#1f123e", avatar:"#ff66cc" },
      "2020": { wall:"#2e884a", floor:"#123e1f", avatar:"#66ffcc" },
      "2025": { wall:"#2e4a88", floor:"#121f3e", avatar:"#ff3355" }
    };

    // Narratives
    const ERA_TEXT = {
      "2006": ["Era 2006 • 6-bit avatar","Roblox launched as a physics sandbox.","Tickets & Robux shaped the early economy."],
      "2012": ["Era 2012 • 8-bit avatar","Badges and improved avatars.","Community events expanded."],
      "2015": ["Era 2015 • 12-bit avatar","DevEx program launched.","Economy matured."],
      "2016": ["Era 2016 • 16-bit avatar","Mobile & console support.","Marketplace boosted creators."],
      "2018": ["Era 2018 • 20-bit avatar","UGC marketplace expanded.","Plugins improved Studio."],
      "2020": ["Era 2020 • 24-bit avatar","Virtual concerts & global events.","Massive growth."],
      "2025": ["Era 2025 • Bacon avatar","VR & brands integrated.","Social hub."]
    };

    // Banner timing
    const BANNER_SHOW_MS = 8000;
    const BANNER_FADE_MS = 1500;

    // Maze generator (DFS)
    function generateMaze(width, height, requiresKey=false) {
      let grid = Array.from({length:height},()=>Array(width).fill("#"));
      function carve(x,y){
        const dirs=[[2,0],[-2,0],[0,2],[0,-2]];
        for(let [dx,dy] of dirs.sort(()=>Math.random()-0.5)){
          let nx=x+dx, ny=y+dy;
          if(nx>0&&ny>0&&nx<width-1&&ny<height-1 && grid[ny][nx]==="#"){
            grid[ny][nx]=".";
            grid[y+dy/2][x+dx/2]=".";
            carve(nx,ny);
          }
        }
      }
      grid[1][1]="S";
      carve(1,1);
      grid[height-2][width-2]="G";
      if(requiresKey) grid[Math.floor(height/2)][Math.floor(width/2)]="K";
      return grid;
    }

    // Sprinkle traps
    function sprinkleTraps(grid,count=5){
      let coords=[];
      for(let y=1;y<grid.length-1;y++){
        for(let x=1;x<grid[y].length-1;x++){
          if(grid[y][x]===".") coords.push([x,y]);
        }
      }
      for(let i=0;i<count;i++){
        let [x,y]=coords[Math.floor(Math.random()*coords.length)];
        grid[y][x]="T";
      }
      return grid;
    }

    // Build 7 mazes
    const eras=["2006","2012","2015","2016","2018","2020","2025"];
    let mazes=eras.map((era,i)=>({
      era,
      grid: sprinkleTraps(generateMaze(21,15,i%2===1),5)
    }));

    // State
    let currentLevel=0;
    let pos={x:0,y:0};
    let vel={x:0,y:0};
    let started=false, paused=false;
    let keysHeld=new Set();
    let bannerQueue=[], bannerShowing=false, distAcc=0;
    let maze=parseMaze(currentLevel);

    function showBannerOnce(text){
      bannerShowing=true;
      bannerEl.textContent=text;
      bannerEl.classList.add("show");
      setTimeout(()=>{
        bannerEl.classList.remove("show");
        setTimeout(()=>{bannerShowing=false; bannerEl.textContent="";},BANNER_FADE_MS);
      },BANNER_SHOW_MS);
    }

    function parseMaze(level){
      const grid=mazes[level].grid;
      let start={x:1,y:1}, goal={x:grid[0].length-2,y:grid.length-2};
      return {grid,start,goal};
    }

    function resetLevel(level=0){
      currentLevel=level;
      maze=parseMaze(currentLevel);
      pos={x:maze.start.x*TILE+TILE/2,y:maze.start.y*TILE+TILE/2};
      vel={x:0,y:0};
      bannerQueue=[...ERA_TEXT[mazes[currentLevel].era]];
      if(bannerQueue.length) showBannerOnce(bannerQueue.shift());
    }

    function drawGrid(theme,grid){
      ctx.fillStyle=theme.floor;
      ctx.fillRect(0,0,canvas.width,canvas.height);
      for(let y=0;y
